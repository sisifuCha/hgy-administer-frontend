# 候补规则管理API

## 1. API概述

候补规则管理API用于管理医院挂号系统中的各种候补规则，包括查看规则列表和更新规则值。这些规则控制着患者候补挂号的各种限制条件，如单个患者最大候补数量、单个排班最大候补人数等。

## 2. 基础信息

- **服务基础URL**：`http://localhost:8080`（根据实际部署情况调整）
- **API前缀**：`/admin`
- **认证方式**：需要管理员身份认证（JWT令牌）
- **请求格式**：JSON
- **响应格式**：统一Result格式

## 3. 接口列表

| 接口名称 | 请求方法 | URL | 功能描述 |
|---------|---------|-----|---------|
| 查看候补规则 | GET | `/admin/getWaitingRules` | 获取所有候补规则列表 |
| 更新规则值 | PUT | `/admin/changeRuleValue` | 更新一个或多个规则的值 |

## 4. 详细接口说明

### 4.1 查看候补规则

**接口功能**：获取所有候补规则的详细信息

**请求方式**：GET

**请求URL**：`/admin/getWaitingRules`

**请求参数**：无

**响应格式**：
```json
{
  "code": 200,
  "msg": "成功",
  "data": {
    "rules": [
      {
        "id": 1,
        "ruleName": "MAX_PATIENT_WAITING",
        "ruleValue": 5,
        "description": "单个患者最大候补数量",
        "createdAt": "2023-06-15T10:30:00",
        "updatedAt": "2023-06-15T10:30:00"
      },
      {
        "id": 2,
        "ruleName": "MAX_WAITING_COUNT",
        "ruleValue": 100,
        "description": "单个排班最大候补人数",
        "createdAt": "2023-06-15T10:30:00",
        "updatedAt": "2023-06-15T10:30:00"
      },
      {
        "id": 3,
        "ruleName": "STOP_HOURS_BEFORE",
        "ruleValue": 3,
        "description": "就诊前停止候补的小时数",
        "createdAt": "2023-06-15T10:30:00",
        "updatedAt": "2023-06-15T10:30:00"
      }
    ]
  }
}
```

**响应参数说明**：
| 参数名 | 类型 | 描述 |
|-------|------|------|
| code | Integer | 响应状态码，200表示成功 |
| msg | String | 响应消息 |
| data | Object | 响应数据 |
| data.rules | Array | 规则列表 |
| rules.id | Integer | 规则ID |
| rules.ruleName | String | 规则名称（唯一标识） |
| rules.ruleValue | Integer | 规则值 |
| rules.description | String | 规则描述 |
| rules.createdAt | LocalDateTime | 创建时间 |
| rules.updatedAt | LocalDateTime | 更新时间 |

**示例请求**：
```bash
curl -X GET "http://localhost:8080/admin/getWaitingRules" -H "Authorization: Bearer {your_token}"
```

### 4.2 更新规则值

**接口功能**：更新一个或多个候补规则的值

**请求方式**：PUT

**请求URL**：`/admin/changeRuleValue`

**请求参数**：
```json
{
  "newValues": {
    "1": 10,
    "2": 150
  }
}
```

**请求参数说明**：
| 参数名 | 类型 | 描述 |
|-------|------|------|
| newValues | Object | 规则更新对象 |
| newValues.{ruleId} | Integer | 规则ID对应的新值 |

**响应格式**：
```json
{
  "code": 200,
  "msg": "更新规则值成功",
  "data": "更新规则值成功"
}
```

**错误响应示例**：
```json
{
  "code": 400,
  "msg": "规则ID格式错误",
  "data": null
}
```

**响应参数说明**：
| 参数名 | 类型 | 描述 |
|-------|------|------|
| code | Integer | 响应状态码，200表示成功，其他表示失败 |
| msg | String | 响应消息 |
| data | String | 响应数据（成功时为成功消息） |

**示例请求**：
```bash
curl -X PUT "http://localhost:8080/admin/changeRuleValue" \
-H "Authorization: Bearer {your_token}" \
-H "Content-Type: application/json" \
-d '{
  "newValues": {
    "1": 10,
    "2": 150
  }
}'
```

## 5. 规则说明

| 规则名称 | 默认值 | 描述 |
|---------|-------|------|
| MAX_PATIENT_WAITING | 5 | 单个患者最多可以同时存在的候补记录数量 |
| MAX_WAITING_COUNT | 100 | 单个排班最多允许的候补人数 |
| STOP_HOURS_BEFORE | 3 | 就诊前多少小时停止接受新的候补请求 |

## 6. 错误码说明

| 错误码 | 错误信息 | 描述 |
|-------|---------|------|
| 200 | 成功 | 操作成功 |
| 400 | 没有需要更新的规则值 | 请求体中没有提供任何规则更新 |
| 400 | 规则ID格式错误 | 提供的规则ID不是有效的整数格式 |
| 500 | 获取候补规则失败 | 数据库查询失败 |
| 500 | 更新规则值失败 | 数据库更新失败 |

## 7. 注意事项

1. 所有接口都需要管理员身份认证，请求头中必须包含有效的JWT令牌
2. 更新规则时，规则ID必须是已存在的有效ID
3. 规则值必须是有效的整数，否则会导致更新失败
4. 规则更新后立即生效，会影响所有新的候补请求
5. 修改规则前请仔细考虑对现有候补记录的影响